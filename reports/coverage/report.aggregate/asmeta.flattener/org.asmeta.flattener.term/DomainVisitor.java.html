<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="it"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>DomainVisitor.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">report.aggregate</a> &gt; <a href="../index.html" class="el_bundle">asmeta.flattener</a> &gt; <a href="index.source.html" class="el_package">org.asmeta.flattener.term</a> &gt; <span class="el_source">DomainVisitor.java</span></div><h1>DomainVisitor.java</h1><pre class="source lang-java linenums">package org.asmeta.flattener.term;

import java.util.HashMap;
import java.util.HashSet;
import java.util.List;
import java.util.Set;

import org.asmeta.parser.Defs;
import org.asmeta.simulator.wrapper.RuleFactory;
import org.eclipse.emf.common.util.EList;

import asmeta.definitions.Function;
import asmeta.definitions.domains.AbstractTd;
import asmeta.definitions.domains.AgentDomain;
import asmeta.definitions.domains.ConcreteDomain;
import asmeta.definitions.domains.Domain;
import asmeta.definitions.domains.EnumElement;
import asmeta.definitions.domains.EnumTd;
import asmeta.structure.Asm;
import asmeta.structure.DomainDefinition;
import asmeta.structure.Signature;
import asmeta.terms.basicterms.BooleanTerm;
import asmeta.terms.basicterms.SetTerm;
import asmeta.terms.basicterms.Term;
import asmeta.terms.furtherterms.EnumTerm;

<span class="pc bpc" id="L27" title="1 of 2 branches missed.">public class DomainVisitor {</span>
	private Asm asm;
	// map of domains: it contains a pair (domain name - domains values)
	public HashMap&lt;String, Set&lt;Term&gt;&gt; domainSet;

<span class="fc" id="L32">	public DomainVisitor(Asm asm) {</span>
<span class="fc" id="L33">		this.asm = asm;</span>
<span class="fc" id="L34">		domainSet = new HashMap&lt;String, Set&lt;Term&gt;&gt;();</span>
<span class="fc" id="L35">	}</span>

	public void visitDomains() {
		// Boolean domain
<span class="fc" id="L39">		Set&lt;Term&gt; set = new HashSet&lt;Term&gt;();</span>
<span class="fc" id="L40">		RuleFactory rf = new RuleFactory();</span>
<span class="fc" id="L41">		BooleanTerm trueTerm = rf.createBooleanTerm();</span>
<span class="fc" id="L42">		trueTerm.setSymbol(&quot;true&quot;);</span>
<span class="fc" id="L43">		BooleanTerm falseTerm = rf.createBooleanTerm();</span>
<span class="fc" id="L44">		falseTerm.setSymbol(&quot;false&quot;);</span>
<span class="fc" id="L45">		set.add(trueTerm);</span>
<span class="fc" id="L46">		set.add(falseTerm);</span>
<span class="fc" id="L47">		domainSet.put(&quot;Boolean&quot;, set);</span>

		// TODO ï¿½ 0, quando ci sono agenti, quindi il controllo per agent?
<span class="fc" id="L50">		Integer i = asm.getBodySection().getDomainDefinition().size();</span>

<span class="fc bfc" id="L52" title="All 2 branches covered.">		for (DomainDefinition def : asm.getBodySection().getDomainDefinition()) {</span>
<span class="fc" id="L53">			ConcreteDomain concreteDomain = def.getDefinedDomain();</span>
<span class="fc" id="L54">			Term body = def.getBody();</span>

<span class="pc bpc" id="L56" title="2 of 4 branches missed.">			assert !(def.getDefinedDomain().getTypeDomain() instanceof AgentDomain);</span>
			// if it's not an agent domain
<span class="fc" id="L58">			SetTerm st = null;</span>
<span class="pc bpc" id="L59" title="1 of 2 branches missed.">			if (body instanceof SetTerm) {</span>
<span class="fc" id="L60">				st = (SetTerm) body;</span>
			}
<span class="pc bpc" id="L62" title="2 of 4 branches missed.">			assert st != null;</span>
<span class="fc" id="L63">			set = new HashSet&lt;Term&gt;();</span>
<span class="fc bfc" id="L64" title="All 2 branches covered.">			for (Term t : st.getTerm()) {</span>
<span class="fc" id="L65">				set.add(t);</span>
<span class="fc" id="L66">			}</span>
<span class="fc" id="L67">			domainSet.put(concreteDomain.getName(), set);</span>
<span class="fc" id="L68">		}</span>
<span class="fc" id="L69">		Signature signature = asm.getHeaderSection().getSignature();</span>
<span class="fc" id="L70">		List&lt;Function&gt; functions = signature.getFunction();</span>
<span class="fc bfc" id="L71" title="All 2 branches covered.">		for (Domain domain : signature.getDomain()) {</span>
<span class="fc bfc" id="L72" title="All 4 branches covered.">			if (Defs.isConcreteDomain(domain) &amp;&amp; !(((ConcreteDomain) domain).getTypeDomain() instanceof AgentDomain)) {</span>
<span class="fc" id="L73">				continue;// concrete domains are visited in the definition section (except for agents)</span>
			}
<span class="fc bfc" id="L75" title="All 2 branches covered.">			if (Defs.isEnumDomain(domain)) {</span>
				// all domains in this branch are Enum domain, so the casting is safe
<span class="fc" id="L77">				EnumTd enumDomain = (EnumTd) domain;</span>
				// get the list of elements of enum domain
<span class="fc" id="L79">				EList&lt;EnumElement&gt; enumElementList = enumDomain.getElement();</span>

<span class="fc" id="L81">				set = new HashSet&lt;Term&gt;();</span>
<span class="fc" id="L82">				EnumTerm enumTerm = null;</span>
<span class="fc bfc" id="L83" title="All 2 branches covered.">				for (EnumElement ee : enumElementList) {</span>
					// create the EnumTerm relative to the EnumElement
<span class="fc" id="L85">					enumTerm = rf.createEnumTerm();</span>
<span class="fc" id="L86">					enumTerm.setSymbol(ee.getSymbol());</span>
<span class="fc" id="L87">					enumTerm.setDomain(domain);</span>
					// add the EnumDomain values to the set of terms
<span class="fc" id="L89">					set.add(enumTerm);</span>
<span class="fc" id="L90">				}</span>
				// add to the domains map, the name of domain and the values inside
<span class="fc" id="L92">				domainSet.put(domain.getName(), set);</span>
<span class="fc bfc" id="L93" title="All 2 branches covered.">			} else if (Defs.isAbstractDomain(domain)) {</span>
<span class="fc" id="L94">				AbstractTd abstractDomain = (AbstractTd) domain;</span>
<span class="fc" id="L95">				EnumTerm enumTerm = null;</span>
<span class="fc" id="L96">				set = new HashSet&lt;Term&gt;();</span>

				// find the abstract domain elements from the functions of the signature
<span class="fc bfc" id="L99" title="All 2 branches covered.">				for (Function f : functions) {</span>
					// the criterion is: static, without arguments, its codomain is the abstract
					// domain
<span class="fc bfc" id="L102" title="All 4 branches covered.">					if (f.getCodomain().getName().equals(abstractDomain.getName()) &amp;&amp; f.getArity() == 0</span>
<span class="fc bfc" id="L103" title="All 2 branches covered.">							&amp;&amp; Defs.isAbstractConst(f)) {</span>
						// create the EnumTerm relative to the static function
<span class="fc" id="L105">						enumTerm = rf.createEnumTerm();</span>
<span class="fc" id="L106">						enumTerm.setSymbol(f.getName());</span>
<span class="fc" id="L107">						enumTerm.setDomain(f.getCodomain());</span>
						// add the EnumDomain values to the set of terms
<span class="fc" id="L109">						set.add(enumTerm);</span>
					}
<span class="fc" id="L111">				}</span>
				// add to the domains map, the name of domain and the values inside
<span class="fc" id="L113">				domainSet.put(domain.getName(), set);</span>
<span class="pc bpc" id="L114" title="1 of 2 branches missed.">			} else if (Defs.isConcreteDomain(domain)</span>
<span class="pc bpc" id="L115" title="1 of 2 branches missed.">					&amp;&amp; ((ConcreteDomain) domain).getTypeDomain() instanceof AgentDomain) {</span>
				// if it's an agent domain
				// AgentDomain agentDomain = ((ConcreteDomain)domain).getTypeDomain();
<span class="fc" id="L118">				EnumTerm enumTerm = null;</span>
<span class="fc" id="L119">				set = new HashSet&lt;Term&gt;();</span>

				// find the agents from the functions of the signature
<span class="fc bfc" id="L122" title="All 2 branches covered.">				for (Function f : functions) {</span>
					// the criterion is: .....
<span class="fc bfc" id="L124" title="All 4 branches covered.">					if (f.getCodomain().getName().equals(domain.getName()) &amp;&amp; f.getArity() == 0) {</span>
						// create the EnumTerm relative to the agent
<span class="fc" id="L126">						enumTerm = rf.createEnumTerm();</span>
<span class="fc" id="L127">						enumTerm.setSymbol(f.getName());</span>
<span class="fc" id="L128">						enumTerm.setDomain(f.getCodomain());</span>
						// add the EnumDomain values to the set of terms
<span class="fc" id="L130">						set.add(enumTerm);</span>
					}
<span class="fc" id="L132">				}</span>
				// add to the domains map, the name of domain and the values inside
<span class="fc" id="L134">				domainSet.put(domain.getName(), set);</span>
<span class="pc bnc" id="L135" title="All 2 branches missed.">			} else if (Defs.isConcreteDomain(domain)</span>
<span class="nc bnc" id="L136" title="All 2 branches missed.">					&amp;&amp; ((ConcreteDomain) domain).getTypeDomain() instanceof AbstractTd) {</span>
				// if it's an agent domain
				// AgentDomain agentDomain = ((ConcreteDomain)domain).getTypeDomain();
<span class="nc" id="L139">				EnumTerm enumTerm = null;</span>
<span class="nc" id="L140">				set = new HashSet&lt;Term&gt;();</span>

				// find the agents from the functions of the signature
<span class="nc bnc" id="L143" title="All 2 branches missed.">				for (Function f : functions) {</span>
					// the criterion is: .....
<span class="nc bnc" id="L145" title="All 4 branches missed.">					if (f.getCodomain().getName().equals(domain.getName()) &amp;&amp; f.getArity() == 0) {</span>
						// create the EnumTerm relative to the agent
<span class="nc" id="L147">						enumTerm = rf.createEnumTerm();</span>
<span class="nc" id="L148">						enumTerm.setSymbol(f.getName());</span>
<span class="nc" id="L149">						enumTerm.setDomain(f.getCodomain());</span>
						// add the EnumDomain values to the set of terms
<span class="nc" id="L151">						set.add(enumTerm);</span>
					}
<span class="nc" id="L153">				}</span>
				// add to the domains map, the name of domain and the values inside
<span class="nc" id="L155">				domainSet.put(domain.getName(), set);</span>
<span class="nc" id="L156">			}</span>

			else {
<span class="nc" id="L159">				throw new Error(&quot;Domain &quot; + domain.getClass().getSimpleName() + &quot; not supported.&quot;);</span>
			}
<span class="fc" id="L161">		}</span>

<span class="fc" id="L163">		set = new HashSet&lt;Term&gt;();</span>
<span class="fc bfc" id="L164" title="All 2 branches covered.">		for (Function f : functions) {</span>
			// the criterion is: static, without arguments, its codomain is the abstract
			// domain
<span class="pc bpc" id="L167" title="5 of 6 branches missed.">			if (f.getCodomain().getName().equals(&quot;Agent&quot;) &amp;&amp; f.getArity() == 0 &amp;&amp; Defs.isAbstractConst(f)) {</span>
				// create the EnumTerm relative to the static function
<span class="nc" id="L169">				EnumTerm enumTerm = rf.createEnumTerm();</span>
<span class="nc" id="L170">				enumTerm.setSymbol(f.getName());</span>
<span class="nc" id="L171">				enumTerm.setDomain(f.getCodomain());</span>
				// add the EnumDomain values to the set of terms
<span class="nc" id="L173">				set.add(enumTerm);</span>
			}
<span class="fc" id="L175">		}</span>
<span class="pc bpc" id="L176" title="1 of 2 branches missed.">		if (set.size() &gt; 0) {</span>
<span class="nc" id="L177">			domainSet.put(&quot;Agent&quot;, set);</span>
		}
<span class="fc" id="L179">	}</span>

	public Set&lt;Term&gt; getValue(String domainName) {
<span class="fc" id="L182">		return domainSet.get(domainName);</span>
	}

	public Set&lt;Term&gt; getValues(Domain domain) {
<span class="fc" id="L186">		return getValue(domain.getName());</span>
	}

	public HashMap&lt;String, Set&lt;Term&gt;&gt; getDomainSet() {
<span class="fc" id="L190">		return domainSet;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>