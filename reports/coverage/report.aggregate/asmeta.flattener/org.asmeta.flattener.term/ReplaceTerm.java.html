<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="it"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>ReplaceTerm.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">report.aggregate</a> &gt; <a href="../index.html" class="el_bundle">asmeta.flattener</a> &gt; <a href="index.source.html" class="el_package">org.asmeta.flattener.term</a> &gt; <span class="el_source">ReplaceTerm.java</span></div><h1>ReplaceTerm.java</h1><pre class="source lang-java linenums">package org.asmeta.flattener.term;

import java.util.List;

import org.asmeta.simulator.wrapper.RuleFactory;
import org.eclipse.emf.common.util.EList;

import asmeta.terms.basicterms.BooleanTerm;
import asmeta.terms.basicterms.DomainTerm;
import asmeta.terms.basicterms.FunctionTerm;
import asmeta.terms.basicterms.LocationTerm;
import asmeta.terms.basicterms.Term;
import asmeta.terms.basicterms.TupleTerm;
import asmeta.terms.basicterms.UndefTerm;
import asmeta.terms.basicterms.VariableTerm;
import asmeta.terms.furtherterms.CaseTerm;
import asmeta.terms.furtherterms.ConditionalTerm;
import asmeta.terms.furtherterms.EnumTerm;
import asmeta.terms.furtherterms.ForallTerm;
import asmeta.terms.furtherterms.IntegerTerm;
import asmeta.terms.furtherterms.NaturalTerm;
import asmeta.terms.furtherterms.StringTerm;

public class ReplaceTerm extends TermFlattenerVisitor {
	private String termToChange;
	private Term newTerm;
	private String newTermAsStr;
	private RuleFactory ruleFact;

<span class="nc" id="L30">	public ReplaceTerm(String termToChange, Term newTerm) {</span>
<span class="nc" id="L31">		this.termToChange = termToChange;</span>
<span class="nc" id="L32">		this.newTerm = newTerm;</span>
<span class="nc" id="L33">		newTermAsStr = Utils.print(newTerm);</span>
<span class="nc" id="L34">		ruleFact = new RuleFactory();</span>
<span class="nc" id="L35">	}</span>

	private boolean mustBeChanged(Term t) {
<span class="nc" id="L38">		return Utils.print(t).equals(termToChange);</span>
	}

	public Term visit(VariableTerm vt) {
<span class="nc bnc" id="L42" title="All 2 branches missed.">		if (mustBeChanged(vt)) {</span>
<span class="nc" id="L43">			return newTerm;</span>
		}
<span class="nc" id="L45">		return vt;</span>
	}

	public Term visit(LocationTerm lt) {
<span class="nc bnc" id="L49" title="All 2 branches missed.">		if (mustBeChanged(lt)) {</span>
<span class="nc" id="L50">			return newTerm;</span>
		}

<span class="nc" id="L53">		LocationTerm newLocTerm = ruleFact.createLocationTerm();</span>

<span class="nc" id="L55">		newLocTerm.setFunction(lt.getFunction());</span>
<span class="nc" id="L56">		newLocTerm.setDomain(lt.getDomain());</span>

		// set arguments in new LocationTerm
<span class="nc" id="L59">		TupleTerm tupleTerm = lt.getArguments();</span>
<span class="nc bnc" id="L60" title="All 2 branches missed.">		if (tupleTerm != null) {</span>
<span class="nc" id="L61">			TupleTerm newTupleTerm = ruleFact.createTupleTerm();</span>
<span class="nc" id="L62">			newTupleTerm.setArity(tupleTerm.getArity());</span>
<span class="nc" id="L63">			newTupleTerm.setDomain(tupleTerm.getDomain());</span>
<span class="nc bnc" id="L64" title="All 2 branches missed.">			for (Term arg : tupleTerm.getTerms()) {</span>
<span class="nc" id="L65">				Term x = visit(arg);</span>
<span class="nc" id="L66">				newTupleTerm.getTerms().add(x);</span>
<span class="nc" id="L67">			}</span>
<span class="nc" id="L68">			newLocTerm.setArguments(newTupleTerm);</span>
		}
<span class="nc" id="L70">		return newLocTerm;</span>
	}

	public Term visit(FunctionTerm ft) {
<span class="nc bnc" id="L74" title="All 2 branches missed.">		if (ft.getFunction().getName().equals(&quot;eq&quot;)) {</span>
<span class="nc" id="L75">			List&lt;Term&gt; args = ft.getArguments().getTerms();</span>
<span class="nc" id="L76">			String firstArg = Utils.print(args.get(0));</span>
<span class="nc" id="L77">			String secondArg = Utils.print(args.get(1));</span>
<span class="nc bnc" id="L78" title="All 4 branches missed.">			if ((firstArg.equals(termToChange) &amp;&amp; secondArg.equals(newTermAsStr))</span>
<span class="nc bnc" id="L79" title="All 4 branches missed.">					|| (secondArg.equals(termToChange) &amp;&amp; firstArg.equals(newTermAsStr))) {</span>
<span class="nc" id="L80">				return ft;</span>
			}
		}

<span class="nc bnc" id="L84" title="All 2 branches missed.">		if (mustBeChanged(ft)) {</span>
<span class="nc" id="L85">			return newTerm;</span>
		}

<span class="nc" id="L88">		FunctionTerm newFunctionTerm = ruleFact.createFunctionTerm();</span>
<span class="nc" id="L89">		newFunctionTerm.setDomain(ft.getDomain());</span>
<span class="nc" id="L90">		newFunctionTerm.setFunction(ft.getFunction());</span>

		// set arguments in new FunctionTerm
<span class="nc bnc" id="L93" title="All 2 branches missed.">		if (ft.getArguments() != null) {</span>
<span class="nc" id="L94">			TupleTerm tupleTerm = ft.getArguments();</span>
<span class="nc" id="L95">			TupleTerm newTupleTerm = ruleFact.createTupleTerm(); // TODO newLocTerm.getArguments();</span>
<span class="nc" id="L96">			newTupleTerm.setArity(tupleTerm.getArity());</span>
<span class="nc" id="L97">			newTupleTerm.setDomain(tupleTerm.getDomain());</span>

<span class="nc" id="L99">			List&lt;Term&gt; terms = newTupleTerm.getTerms();</span>
<span class="nc bnc" id="L100" title="All 2 branches missed.">			for (Term arg : tupleTerm.getTerms()) {</span>
<span class="nc" id="L101">				terms.add(visit(arg));</span>
<span class="nc" id="L102">			}</span>
<span class="nc" id="L103">			newFunctionTerm.setArguments(newTupleTerm);</span>
		}
<span class="nc" id="L105">		return newFunctionTerm;</span>
	}

	public Term visit(IntegerTerm it) {
<span class="nc bnc" id="L109" title="All 2 branches missed.">		if (mustBeChanged(it)) {</span>
<span class="nc" id="L110">			return newTerm;</span>
		}
<span class="nc" id="L112">		return it;</span>
	}

	public Term visit(StringTerm strTerm) {
<span class="nc bnc" id="L116" title="All 2 branches missed.">		if (mustBeChanged(strTerm)) {</span>
<span class="nc" id="L117">			return newTerm;</span>
		}
<span class="nc" id="L119">		return strTerm;</span>
	}

	public Term visit(EnumTerm et) {
<span class="nc bnc" id="L123" title="All 2 branches missed.">		if (mustBeChanged(et)) {</span>
<span class="nc" id="L124">			return newTerm;</span>
		}
<span class="nc" id="L126">		return et;</span>
	}

	public Term visit(BooleanTerm bt) {
<span class="nc bnc" id="L130" title="All 2 branches missed.">		if (mustBeChanged(bt)) {</span>
<span class="nc" id="L131">			return newTerm;</span>
		}
<span class="nc" id="L133">		return bt;</span>
	}

	public Term visit(ConditionalTerm ct) {
<span class="nc bnc" id="L137" title="All 2 branches missed.">		if (mustBeChanged(ct)) {</span>
<span class="nc" id="L138">			return newTerm;</span>
		}
<span class="nc" id="L140">		ConditionalTerm newConditionalTerm = ruleFact.createConditionalTerm();</span>
<span class="nc" id="L141">		newConditionalTerm.setDomain(ct.getDomain());</span>
<span class="nc" id="L142">		newConditionalTerm.setElseTerm(visit(ct.getElseTerm()));</span>
<span class="nc" id="L143">		newConditionalTerm.setGuard(visit(ct.getGuard()));</span>
<span class="nc" id="L144">		newConditionalTerm.setThenTerm(visit(ct.getElseTerm()));</span>
<span class="nc" id="L145">		return newConditionalTerm;</span>
	}

	public Term visit(CaseTerm ct) {
<span class="nc bnc" id="L149" title="All 2 branches missed.">		if (mustBeChanged(ct)) {</span>
<span class="nc" id="L150">			return newTerm;</span>
		}
<span class="nc" id="L152">		CaseTerm newCaseTerm = ruleFact.createCaseTerm();</span>
<span class="nc" id="L153">		newCaseTerm.setComparedTerm(visit(ct.getComparedTerm()));</span>
<span class="nc" id="L154">		newCaseTerm.setDomain(ct.getDomain());</span>
<span class="nc" id="L155">		newCaseTerm.setOtherwiseTerm(visit(ct.getComparedTerm()));</span>

<span class="nc" id="L157">		EList&lt;Term&gt; compT = newCaseTerm.getComparingTerm();</span>
<span class="nc bnc" id="L158" title="All 2 branches missed.">		for (Term arg : ct.getComparingTerm()) {</span>
<span class="nc" id="L159">			compT.add(visit(arg));</span>
<span class="nc" id="L160">		}</span>
<span class="nc" id="L161">		EList&lt;Term&gt; resT = newCaseTerm.getResultTerms();</span>
<span class="nc bnc" id="L162" title="All 2 branches missed.">		for (Term arg : ct.getResultTerms()) {</span>
<span class="nc" id="L163">			resT.add(visit(arg));</span>
<span class="nc" id="L164">		}</span>
<span class="nc" id="L165">		return newCaseTerm;</span>
	}

	public Term visit(ForallTerm forallTerm) {
<span class="nc bnc" id="L169" title="All 2 branches missed.">		if (mustBeChanged(forallTerm)) {</span>
<span class="nc" id="L170">			return newTerm;</span>
		}
<span class="nc" id="L172">		ForallTerm newForallTerm = ruleFact.createForallTerm();</span>
<span class="nc" id="L173">		newForallTerm.setGuard(visit(forallTerm.getGuard()));</span>
<span class="nc" id="L174">		newForallTerm.getRanges().addAll(forallTerm.getRanges());</span>
<span class="nc" id="L175">		newForallTerm.getVariable().addAll(forallTerm.getVariable());</span>
<span class="nc" id="L176">		return newForallTerm;</span>
	}

	public Term visit(TupleTerm tt) {
<span class="nc bnc" id="L180" title="All 2 branches missed.">		if (mustBeChanged(tt)) {</span>
<span class="nc" id="L181">			return newTerm;</span>
		}
<span class="nc" id="L183">		return tt;</span>
	}

	public Term visit(DomainTerm dt) {
<span class="nc bnc" id="L187" title="All 2 branches missed.">		if (mustBeChanged(dt)) {</span>
<span class="nc" id="L188">			return newTerm;</span>
		}
<span class="nc" id="L190">		return dt;</span>
	}

	public Term visit(NaturalTerm nt) {
<span class="nc bnc" id="L194" title="All 2 branches missed.">		if (mustBeChanged(nt)) {</span>
<span class="nc" id="L195">			return newTerm;</span>
		}
<span class="nc" id="L197">		return nt;</span>
	}

	public Term visit(UndefTerm ut) {
<span class="nc bnc" id="L201" title="All 2 branches missed.">		if (mustBeChanged(ut)) {</span>
<span class="nc" id="L202">			return newTerm;</span>
		}
<span class="nc" id="L204">		return ut;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>