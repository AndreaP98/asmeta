<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="it"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>RandomMFReader.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">report.aggregate</a> &gt; <a href="../index.html" class="el_bundle">asmeta.simulator</a> &gt; <a href="index.source.html" class="el_package">org.asmeta.simulator.readers</a> &gt; <span class="el_source">RandomMFReader.java</span></div><h1>RandomMFReader.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 * Copyright (c) 2009 .
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 * 
 * Contributors:
 *      - initial API and implementation
 ******************************************************************************/
package org.asmeta.simulator.readers;

import java.io.PrintStream;
import java.util.ArrayList;
import java.util.List;
import java.util.Random;

import org.asmeta.simulator.Location;
import org.asmeta.simulator.State;
import org.asmeta.simulator.TermEvaluator;
import org.asmeta.simulator.value.BooleanValue;
import org.asmeta.simulator.value.EnumValue;
import org.asmeta.simulator.value.IntegerValue;
import org.asmeta.simulator.value.RealValue;
import org.asmeta.simulator.value.ReserveValue;
import org.asmeta.simulator.value.SequenceValue;
import org.asmeta.simulator.value.SetValue;
import org.asmeta.simulator.value.StringValue;
import org.asmeta.simulator.value.TupleValue;
import org.asmeta.simulator.value.Value;

import asmeta.definitions.Function;
import asmeta.definitions.domains.AbstractTd;
import asmeta.definitions.domains.BooleanDomain;
import asmeta.definitions.domains.ConcreteDomain;
import asmeta.definitions.domains.Domain;
import asmeta.definitions.domains.EnumElement;
import asmeta.definitions.domains.IntegerDomain;
import asmeta.definitions.domains.NaturalDomain;
import asmeta.definitions.domains.ProductDomain;
import asmeta.definitions.domains.RealDomain;
import asmeta.definitions.domains.SequenceDomain;
import asmeta.definitions.domains.StringDomain;

/**
 * simulates a random user
 */
<span class="nc bnc" id="L48" title="All 2 branches missed.">public class RandomMFReader extends MonFuncReader {</span>
<span class="nc" id="L49">	static private Random random = new Random();</span>

	public RandomMFReader() {
<span class="nc" id="L52">		this(System.out);</span>
<span class="nc" id="L53">	}</span>

	/**
	 * Random.
	 * 
	 * @param out the output where to show the choices
	 */
<span class="nc" id="L60">	public RandomMFReader(PrintStream out) {</span>
<span class="nc" id="L61">		this.out = out;</span>
<span class="nc" id="L62">	}</span>

	public RandomMFReader(State state) {
<span class="nc" id="L65">		this();</span>
<span class="nc" id="L66">		this.state = state;</span>
<span class="nc" id="L67">	}</span>

	public RandomMFReader(State state, PrintStream out) {
<span class="nc" id="L70">		this(out);</span>
<span class="nc" id="L71">		this.state = state;</span>
<span class="nc" id="L72">	}</span>

	/**
	 * Output stream
	 */
	private PrintStream out;

	@Override
	public Value readValue(Location location, State state) {
<span class="nc" id="L81">		Function func = location.getSignature();</span>
<span class="nc" id="L82">		Value rndValue = visit(func.getCodomain());</span>
<span class="nc bnc" id="L83" title="All 4 branches missed.">		assert rndValue != null;</span>
<span class="nc" id="L84">		out.println(&quot;taking &quot; + rndValue + &quot; for &quot; + location);</span>
<span class="nc" id="L85">		return rndValue;</span>
	}

	public Value visit(Domain domain) {
<span class="nc" id="L89">		return visit((Object) domain);</span>
	}

	public IntegerValue visit(IntegerDomain domain) {
<span class="nc" id="L93">		return new IntegerValue(random.nextInt());</span>
	}

	public IntegerValue visit(NaturalDomain domain) {
<span class="nc" id="L97">		return new IntegerValue(random.nextInt(Integer.MAX_VALUE));</span>
	}

	public RealValue visit(RealDomain domain) {
<span class="nc" id="L101">		boolean sign = random.nextBoolean();</span>
<span class="nc bnc" id="L102" title="All 2 branches missed.">		if (sign)</span>
<span class="nc" id="L103">			return new RealValue(random.nextDouble() * Double.MAX_VALUE);</span>
		else
<span class="nc" id="L105">			return new RealValue(-random.nextDouble() * Double.MAX_VALUE);</span>
	}

	public BooleanValue visit(BooleanDomain domain) {
<span class="nc" id="L109">		return BooleanValue.parseBooleanValue(random.nextBoolean());</span>
	}

	public EnumValue visit(asmeta.definitions.domains.EnumTd domain) {
<span class="nc" id="L113">		int numEl = domain.getElement().size();</span>
<span class="nc" id="L114">		int take = random.nextInt(numEl);</span>
<span class="nc" id="L115">		int i = 0;</span>
<span class="nc bnc" id="L116" title="All 2 branches missed.">		for (Object o : domain.getElement()) {</span>
<span class="nc" id="L117">			EnumElement element = (EnumElement) o;</span>
<span class="nc bnc" id="L118" title="All 2 branches missed.">			if (i == take)</span>
<span class="nc" id="L119">				return new EnumValue(element);</span>
<span class="nc" id="L120">			i++;</span>
<span class="nc" id="L121">		}</span>
<span class="nc" id="L122">		return null;</span>

	}

	public StringValue visit(StringDomain domain) {
<span class="nc" id="L127">		return new StringValue(&quot;fixedrandomestring&quot;);</span>
	}

	static final int max_no_elements = 4;

	public SequenceValue visit(SequenceDomain domain) {
<span class="nc" id="L133">		List&lt;Value&gt; value = new ArrayList&lt;Value&gt;();</span>
		// take 0 to max_no_elements values
<span class="nc" id="L135">		int numEl = random.nextInt(max_no_elements);</span>
<span class="nc bnc" id="L136" title="All 2 branches missed.">		for (int i = 0; i &lt;= numEl; i++) {</span>
<span class="nc" id="L137">			Value val_i = visit(domain.getDomain());</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">			if (val_i == null)</span>
<span class="nc" id="L139">				break;</span>
<span class="nc" id="L140">			value.add(val_i);</span>
		}
<span class="nc" id="L142">		return new SequenceValue(value);</span>
	}

	/** returns null if an element is null */

	public TupleValue visit(ProductDomain domain) {
//		int n = domain.getDomains().size();
<span class="nc" id="L149">		List&lt;Value&gt; value = new ArrayList&lt;Value&gt;();</span>
<span class="nc bnc" id="L150" title="All 2 branches missed.">		for (Object o : domain.getDomains()) {</span>
<span class="nc" id="L151">			Value val_i = visit(o);</span>
<span class="nc bnc" id="L152" title="All 2 branches missed.">			if (val_i == null)</span>
<span class="nc" id="L153">				return null;</span>
<span class="nc" id="L154">			value.add(val_i);</span>
<span class="nc" id="L155">		}</span>
<span class="nc" id="L156">		return new TupleValue(value);</span>
	}

	/** returns null if the abstract domain is empty */
	public ReserveValue visit(AbstractTd domain) {
<span class="nc" id="L161">		return (ReserveValue) getRndElement(domain);</span>
	}

	private Value getRndElement(Domain domain) {
<span class="nc" id="L165">		TermEvaluator tm = new TermEvaluator(state, null, null);</span>
<span class="nc" id="L166">		SetValue set = tm.getValues(domain);</span>
<span class="nc" id="L167">		int n_elements = set.getValue().size();</span>
<span class="nc bnc" id="L168" title="All 2 branches missed.">		if (n_elements == 0)</span>
<span class="nc" id="L169">			return null;</span>
<span class="nc" id="L170">		int i = random.nextInt(n_elements);</span>
<span class="nc" id="L171">		return (Value) set.getValue().toArray()[i];</span>
	}

	public Value visit(ConcreteDomain domain) {
<span class="nc" id="L175">		return getRndElement(domain);</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>