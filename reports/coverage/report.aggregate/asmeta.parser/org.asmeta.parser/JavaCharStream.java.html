<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="it"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>JavaCharStream.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">report.aggregate</a> &gt; <a href="../index.html" class="el_bundle">asmeta.parser</a> &gt; <a href="index.source.html" class="el_package">org.asmeta.parser</a> &gt; <span class="el_source">JavaCharStream.java</span></div><h1>JavaCharStream.java</h1><pre class="source lang-java linenums">/* Generated by: ParserGeneratorCC: Do not edit this line. JavaCharStream.java Version 1.1 */
/* ParserGeneratorCCOptions:SUPPORT_CLASS_VISIBILITY_PUBLIC=true */
package org.asmeta.parser;

/**
 * An implementation of interface CharStream, where the stream is assumed to
 * contain only ASCII characters (with java-like unicode escape processing).
 */
public
class JavaCharStream extends AbstractCharStream
{
  /** Predefined buffer size */
  protected static final int NEXTCHAR_BUF_SIZE = 4096;

  private char[] m_aNextCharBuf;
<span class="fc" id="L16">  private int nextCharInd = -1;</span>
  private java.io.Reader m_aIS;

  @Override
  protected int streamRead(final char[] buffer, final int offset, final int len) throws java.io.IOException
  {
<span class="fc" id="L22">    return m_aIS.read (buffer, offset, len); </span>
  }
  
  @Override
  protected void streamClose() throws java.io.IOException
  {
<span class="fc" id="L28">    m_aIS.close (); </span>
<span class="fc" id="L29">  }</span>

  @Override
  protected void fillBuff() throws java.io.IOException
  {
<span class="fc bfc" id="L34" title="All 2 branches covered.">    if (maxNextCharInd == NEXTCHAR_BUF_SIZE)</span>
    {
<span class="fc" id="L36">      maxNextCharInd = 0;</span>
<span class="fc" id="L37">      nextCharInd = 0;</span>
    }

    try
    {
<span class="fc" id="L42">      final int nCharsRead = streamRead (m_aNextCharBuf, maxNextCharInd, NEXTCHAR_BUF_SIZE - maxNextCharInd);</span>
<span class="fc bfc" id="L43" title="All 2 branches covered.">      if (nCharsRead == -1)</span>
      {
<span class="fc" id="L45">        streamClose ();</span>
<span class="fc" id="L46">        throw new java.io.IOException ();</span>
      }
<span class="fc" id="L48">      maxNextCharInd += nCharsRead;</span>
    }
<span class="fc" id="L50">    catch (final java.io.IOException ex)</span>
    {
<span class="fc bfc" id="L52" title="All 2 branches covered.">      if (bufpos != 0)</span>
      {
<span class="fc" id="L54">        --bufpos;</span>
<span class="fc" id="L55">        backup(0);</span>
      }
      else
<span class="fc" id="L58">        internalSetBufLineColumn (getLine (), getColumn ());</span>
<span class="fc" id="L59">      throw ex;</span>
<span class="fc" id="L60">    }</span>
<span class="fc" id="L61">  }</span>

  private char readByte() throws java.io.IOException
  {
<span class="fc" id="L65">    ++nextCharInd;</span>
<span class="fc bfc" id="L66" title="All 2 branches covered.">    if (nextCharInd &gt;= maxNextCharInd)</span>
<span class="fc" id="L67">      fillBuff();</span>

<span class="fc" id="L69">    return m_aNextCharBuf[nextCharInd];</span>
  }

  @Override
  public char beginToken() throws java.io.IOException
  {
<span class="fc bfc" id="L75" title="All 2 branches covered.">    if (inBuf &gt; 0)</span>
    {
<span class="fc" id="L77">      --inBuf;</span>

<span class="pc bpc" id="L79" title="1 of 2 branches missed.">      if (++bufpos == bufsize)</span>
<span class="nc" id="L80">        bufpos = 0;</span>

<span class="fc" id="L82">      tokenBegin = bufpos;</span>
<span class="fc" id="L83">      return buffer[bufpos];</span>
    }

<span class="fc" id="L86">    tokenBegin = 0;</span>
<span class="fc" id="L87">    bufpos = -1;</span>

<span class="fc" id="L89">    return readChar();</span>
  }

  @Override
  public char readChar() throws java.io.IOException
  {
<span class="fc bfc" id="L95" title="All 2 branches covered.">    if (inBuf &gt; 0)</span>
    {
<span class="fc" id="L97">      --inBuf;</span>
<span class="fc" id="L98">      ++bufpos;</span>
<span class="pc bpc" id="L99" title="1 of 2 branches missed.">      if (bufpos == bufsize)</span>
      {
        // Buffer overflow
<span class="nc" id="L102">        bufpos = 0;</span>
      }

<span class="fc" id="L105">      return buffer[bufpos];</span>
    }

<span class="fc" id="L108">    ++bufpos;</span>
<span class="pc bpc" id="L109" title="1 of 2 branches missed.">    if (bufpos == available)</span>
<span class="nc" id="L110">      internalAdjustBuffSize();</span>

<span class="fc" id="L112">    char c = readByte();</span>
<span class="fc" id="L113">    buffer[bufpos] = c;</span>
<span class="fc bfc" id="L114" title="All 2 branches covered.">    if (c != '\\')</span>
    {
      // Not a backslash
<span class="pc bpc" id="L117" title="1 of 2 branches missed.">      if (isTrackLineColumn()) </span>
<span class="fc" id="L118">        internalUpdateLineColumn(c);</span>
<span class="fc" id="L119">      return c;</span>
    }
    
<span class="pc bpc" id="L122" title="1 of 2 branches missed.">    if (isTrackLineColumn()) </span>
<span class="fc" id="L123">      internalUpdateLineColumn(c);</span>

<span class="fc" id="L125">    int backSlashCnt = 1;</span>

    // Read all the backslashes
    for (;;) 
    {
<span class="fc" id="L130">      ++bufpos;</span>
<span class="pc bpc" id="L131" title="1 of 2 branches missed.">      if (bufpos == available)</span>
<span class="nc" id="L132">        internalAdjustBuffSize();</span>

      try
      {
<span class="fc" id="L136">        c = readByte();</span>
<span class="fc" id="L137">        buffer[bufpos] = c;</span>
<span class="fc bfc" id="L138" title="All 2 branches covered.">        if (c != '\\')</span>
        {
          // found a non-backslash char.
<span class="pc bpc" id="L141" title="1 of 2 branches missed.">          if (isTrackLineColumn()) </span>
<span class="fc" id="L142">             internalUpdateLineColumn(c);</span>
             
<span class="pc bpc" id="L144" title="3 of 4 branches missed.">          if (c == 'u' &amp;&amp; (backSlashCnt &amp; 1) == 1)</span>
          {
<span class="nc" id="L146">            --bufpos;</span>
<span class="nc bnc" id="L147" title="All 2 branches missed.">            if (bufpos &lt; 0)</span>
            {
              // Buffer underflow
<span class="nc" id="L150">              bufpos = bufsize - 1;</span>
            }

            // Found the start of a Unicode sequence
<span class="nc" id="L154">            break;</span>
          }

          // Unsupported escape sequence
<span class="fc" id="L158">          backup(backSlashCnt);</span>
<span class="fc" id="L159">          return '\\';</span>
        }
      }
<span class="nc" id="L162">      catch (final java.io.IOException e)</span>
      {
        // We are returning one backslash so we should only backup (count-1)
<span class="nc bnc" id="L165" title="All 2 branches missed.">        if (backSlashCnt &gt; 1)</span>
<span class="nc" id="L166">          backup (backSlashCnt - 1);</span>

<span class="nc" id="L168">        return '\\';</span>
<span class="fc" id="L169">      }</span>
      
      // We read another backslash

<span class="pc bpc" id="L173" title="1 of 2 branches missed.">      if (isTrackLineColumn()) </span>
<span class="fc" id="L174">        internalUpdateLineColumn (c);</span>
<span class="fc" id="L175">      backSlashCnt++;</span>
    }

    // Here, we have seen an odd number of backslash's followed by a 'u'
    try
    {
      // Skip all 'u' as in '\uuuuuu1234'
<span class="nc bnc" id="L182" title="All 2 branches missed.">      while ((c = readByte()) == 'u')</span>
      {
<span class="nc bnc" id="L184" title="All 2 branches missed.">        if (isTrackLineColumn()) </span>
<span class="nc" id="L185">          internalUpdateLineColumn(c);</span>
      }
      
<span class="nc" id="L188">      final char c1 = c;</span>
<span class="nc" id="L189">      final char c2 = readByte();</span>
<span class="nc" id="L190">      final char c3 = readByte();</span>
<span class="nc" id="L191">      final char c4 = readByte();</span>
<span class="nc" id="L192">      c = (char) (hexval(c1) &lt;&lt; 12 |</span>
<span class="nc" id="L193">                  hexval(c2) &lt;&lt; 8 |</span>
<span class="nc" id="L194">                  hexval(c3) &lt;&lt; 4 |</span>
<span class="nc" id="L195">                  hexval(c4));</span>
<span class="nc" id="L196">      buffer[bufpos] = c;</span>

<span class="nc bnc" id="L198" title="All 2 branches missed.">      if (isTrackLineColumn())</span>
      {
<span class="nc" id="L200">        internalUpdateLineColumn(c1);</span>
<span class="nc" id="L201">        internalUpdateLineColumn(c2);</span>
<span class="nc" id="L202">        internalUpdateLineColumn(c3);</span>
<span class="nc" id="L203">        internalUpdateLineColumn(c4);</span>
      }  
    }
<span class="nc" id="L206">    catch (final java.io.IOException ex)</span>
    {
<span class="nc" id="L208">      throw new IllegalStateException(&quot;Invalid escape character at line &quot; + getLine () + &quot; column &quot; + getColumn () + &quot;.&quot;);</span>
<span class="nc" id="L209">    }</span>

<span class="nc bnc" id="L211" title="All 2 branches missed.">    if (backSlashCnt == 1)</span>
<span class="nc" id="L212">      return c;</span>

<span class="nc" id="L214">    backup(backSlashCnt - 1);</span>
<span class="nc" id="L215">    return '\\';</span>
  }

  /** Constructor. */
  public JavaCharStream(final java.io.Reader dstream,
                        final int startline,
                        final int startcolumn,
                        final int buffersize)
  {
<span class="fc" id="L224">    super (startline, startcolumn, buffersize);</span>
<span class="fc" id="L225">    m_aNextCharBuf = new char[NEXTCHAR_BUF_SIZE];</span>
<span class="fc" id="L226">    m_aIS = dstream;</span>
<span class="fc" id="L227">  }</span>

  /** Constructor. */
  public JavaCharStream(final java.io.Reader dstream,
                        final int startline,
                        final int startcolumn)
  {
<span class="nc" id="L234">    this(dstream, startline, startcolumn, DEFAULT_BUF_SIZE);</span>
<span class="nc" id="L235">  }</span>

  /** Constructor. */
  public JavaCharStream(final java.io.Reader dstream)
  {
<span class="nc" id="L240">    this(dstream, 1, 1, DEFAULT_BUF_SIZE);</span>
<span class="nc" id="L241">  }</span>

  /** Reinitialise. */
  public void reInit(final java.io.Reader dstream)
  {
<span class="nc" id="L246">    reInit(dstream, 1, 1, DEFAULT_BUF_SIZE);</span>
<span class="nc" id="L247">  }</span>

  /** Reinitialise. */
  public void reInit(final java.io.Reader dstream,
                     final int startline,
                     final int startcolumn)
  {
<span class="nc" id="L254">    reInit(dstream, startline, startcolumn, DEFAULT_BUF_SIZE);</span>
<span class="nc" id="L255">  }</span>

  /** Reinitialise. */
  public void reInit(final java.io.Reader dstream,
                     final int startline,
                     final int startcolumn,
                     final int buffersize)
  {
<span class="nc" id="L263">    m_aNextCharBuf = new char[NEXTCHAR_BUF_SIZE];</span>
<span class="nc" id="L264">    nextCharInd = -1;</span>
<span class="nc" id="L265">    m_aIS = dstream;</span>
<span class="nc" id="L266">    super.reInit (startline, startcolumn, buffersize);</span>
<span class="nc" id="L267">  }</span>
  
  /** Constructor. */
  public JavaCharStream(final java.io.InputStream dstream, 
                        final java.nio.charset.Charset encoding, 
                        final int startline,
                        final int startcolumn, 
                        final int buffersize)
  {
<span class="fc" id="L276">    this(new java.io.InputStreamReader(dstream, encoding), startline, startcolumn, buffersize);</span>
<span class="fc" id="L277">  }</span>

  /** Constructor. */
  public JavaCharStream(final java.io.InputStream dstream,
                        final java.nio.charset.Charset encoding,
                        final int startline,
                        final int startcolumn)
  {
<span class="fc" id="L285">    this(dstream, encoding, startline, startcolumn, DEFAULT_BUF_SIZE);</span>
<span class="fc" id="L286">  }</span>

  /** Constructor. */
  public JavaCharStream(final java.io.InputStream dstream, 
                        final java.nio.charset.Charset encoding)
  {
<span class="nc" id="L292">    this(dstream, encoding, 1, 1, DEFAULT_BUF_SIZE);</span>
<span class="nc" id="L293">  }</span>
  
  /** Reinitialise. */
  public void reInit(final java.io.InputStream dstream,
                     final java.nio.charset.Charset encoding)
  {
<span class="nc" id="L299">    reInit(dstream, encoding, 1, 1, DEFAULT_BUF_SIZE);</span>
<span class="nc" id="L300">  }</span>

  /** Reinitialise. */
  public void reInit(final java.io.InputStream dstream,
                     final java.nio.charset.Charset encoding, 
                     final int startline,
                     final int startcolumn)
  {
<span class="nc" id="L308">    reInit(dstream, encoding, startline, startcolumn, DEFAULT_BUF_SIZE);</span>
<span class="nc" id="L309">  }</span>
 
  /** Reinitialise. */
  public void reInit(final java.io.InputStream dstream, 
                     final java.nio.charset.Charset encoding, 
                     final int startline,
                     final int startcolumn,
                     final int buffersize)
  {
<span class="nc" id="L318">    reInit(new java.io.InputStreamReader(dstream, encoding), startline, startcolumn, buffersize);</span>
<span class="nc" id="L319">  }</span>
  
  @Override
  public void done ()
  {
<span class="nc" id="L324">    m_aNextCharBuf = null;</span>
<span class="nc" id="L325">    super.done ();</span>
<span class="nc" id="L326">  }</span>
}
/* ParserGeneratorCC - OriginalChecksum=8ad39d0e6bad353a246a25ca3b481250 (do not edit this line) */
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>