<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="it"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>ReflectiveVisitor.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">report.aggregate</a> &gt; <a href="../index.html" class="el_bundle">asmeta.parser</a> &gt; <a href="index.source.html" class="el_package">org.asmeta.parser.util</a> &gt; <span class="el_source">ReflectiveVisitor.java</span></div><h1>ReflectiveVisitor.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 * Copyright (c) 2005, 2006 ASMETA group (http://asmeta.sourceforge.net)
 * License Information: http://asmeta.sourceforge.net/licensing/
 * 
 *   This program is free software; you can redistribute it and/or modify
 *   it under the terms of the GNU General Public License version 2 as
 *   published by the Free Software Foundation.
 * 
 *   This program is distributed in the hope that it will be useful,
 *   but WITHOUT ANY WARRANTY; without even the implied warranty of
 *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *   GNU General Public License for more details.
 * 
 *   You should have received a copy of the GNU General Public License
 *   along with this program; if not, write to the Free Software
 *   Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301
 *   USA
 * 
 *   http://www.gnu.org/licenses/gpl.txt
 * 
 *   
 *******************************************************************************/

/*
 * ReflectiveVisitor.java
 *
 * Created on 22 maggio 2006, 11.16
 *
 * To change this template, choose Tools | Template Manager
 * and open the template in the editor.
 */

package org.asmeta.parser.util;

import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;

import org.apache.log4j.Logger;

/**
 * Implements a reflective visitor,
 * see &lt;i&gt;Object invokeMethod(Object argument, String methodName)&lt;/i&gt;.
 *
 * @param &lt;T&gt; the generic type of the type returned by the visit
 */
<span class="pc bpc" id="L46" title="1 of 2 branches missed.">public abstract class ReflectiveVisitor&lt;T&gt; {</span>

<span class="fc" id="L48">	private static Logger logger = Logger.getLogger(ReflectiveVisitor.class);</span>

	/**
	 * Equivalent to invokeMethod(object, &quot;visit&quot;).
	 * 
	 */
	public T visit(Object object) {
<span class="fc" id="L55">		logger.debug(&quot;&lt;visit&gt;&quot; + object + &quot;&lt;/visit&gt;&quot;);</span>
<span class="fc" id="L56">		return invokeMethod(object);</span>
	}

	/**
	 * Equivalent to invokeMethod(object, &quot;visit&quot;).
	 */
	protected T invokeMethod(Object object) {
<span class="fc" id="L63">		return invokeMethod(object, &quot;visit&quot;);</span>
	}

	/**
	 * Invokes the method (belonging to this class or to a subclass) with the 
	 * given name and with one formal parameter whose type is the first interface
	 * (i.e. the first returned by getInterfaces()) implemented by the given argument.
	 * 
	 * @param argument the actual parameter
	 * @param methodName the method name
	 * @return the object returned by the invoked method
	 */
	protected T invokeMethod(Object argument, String methodName) {
<span class="fc" id="L76">		Method m = null;</span>
<span class="fc" id="L77">		T result = null;</span>
<span class="pc bpc" id="L78" title="1 of 2 branches missed.">		if (argument != null) {</span>
<span class="pc bpc" id="L79" title="2 of 4 branches missed.">			assert argument!=null;</span>
<span class="fc" id="L80">			Class&lt;?&gt;[] interfaces = argument.getClass().getInterfaces();</span>
<span class="fc" id="L81">			Class&lt;?&gt; anInterface = null;</span>
			try {
<span class="pc bpc" id="L83" title="2 of 4 branches missed.">				assert interfaces != null;</span>
				// take the first interface
<span class="fc" id="L85">				anInterface = interfaces[0];</span>
				//System.out.println(methodName + &quot; - &quot; + anInterface + &quot; - &quot; + argument.toString());
				//logger.debug(&quot;&lt;visiting&gt;Interface:&quot; + anInterface.getName() + &quot;&lt;/visiting&gt;&quot;);
<span class="pc bpc" id="L88" title="2 of 4 branches missed.">				assert methodName != null;</span>
<span class="pc bpc" id="L89" title="2 of 4 branches missed.">				assert anInterface != null;</span>
<span class="fc" id="L90">				m = this.getClass().getMethod(methodName, anInterface);</span>
<span class="pc bpc" id="L91" title="2 of 4 branches missed.">				assert m != null;</span>
<span class="pc bpc" id="L92" title="2 of 4 branches missed.">				assert argument != null;</span>
<span class="fc" id="L93">				result = (T) m.invoke(this, argument);</span>
<span class="nc" id="L94">			} catch (SecurityException e) {</span>
<span class="nc" id="L95">				throw e;</span>
<span class="nc" id="L96">			} catch (IllegalArgumentException e) {</span>
<span class="nc" id="L97">				throw e;</span>
<span class="fc" id="L98">			} catch (NoSuchMethodException e) {</span>
<span class="fc" id="L99">				throw new RuntimeException(</span>
						&quot;Unknown function &quot; + this + &quot; &quot; + methodName + &quot;(&quot; + anInterface + &quot;)&quot;);
						//&quot;Unknown function &quot; + this + &quot; visit(&quot; + anInterface + &quot;)&quot;);
<span class="nc" id="L102">			} catch (IllegalAccessException e) {</span>
<span class="nc" id="L103">				throw new RuntimeException(e);</span>
<span class="fc" id="L104">			} catch (InvocationTargetException e) {</span>
<span class="fc" id="L105">				Throwable cause = e.getCause();</span>
<span class="fc bfc" id="L106" title="All 2 branches covered.">				if (cause instanceof RuntimeException) {</span>
<span class="fc" id="L107">					throw (RuntimeException) e.getCause();</span>
<span class="fc bfc" id="L108" title="All 2 branches covered.">				} else if (cause instanceof java.lang.AssertionError){</span>
<span class="fc" id="L109">					throw (java.lang.AssertionError) e.getCause();</span>
				} else {
<span class="fc" id="L111">					throw new RuntimeException(e.getCause());</span>
				}
<span class="fc" id="L113">			}</span>
		}
<span class="fc" id="L115">		return result;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>